# 汽配全网比价查询工具 - 产品需求文档 (PRD)

| 文档版本 | 修改日期 | 修改人 | 修改内容 |
|---------|---------|-------|---------|
| V1.0    | 2025-01-29 | 产品团队 | 初始版本 |

---

## 文档目录

1. [项目概述](#1-项目概述)
2. [产品定位](#2-产品定位)
3. [用户角色与使用场景](#3-用户角色与使用场景)
4. [功能需求](#4-功能需求)
5. [非功能需求](#5-非功能需求)
6. [数据需求](#6-数据需求)
7. [技术架构](#7-技术架构)
8. [项目规划](#8-项目规划)
9. [风险与应对](#9-风险与应对)

---

## 1. 项目概述

### 1.1 项目背景

汽配市场具有以下行业特点：
- **SKU 繁杂**：单一车型零件数量庞大，原厂 OE 码体系复杂
- **渠道分散**：采购渠道涵盖电商平台（途虎、京东、1688）、线下汽配城、垂直平台等
- **信息不对称**：同一 OE 码在不同平台价格差异显著，人工比价耗时耗力
- **效率低下**：采购人员需在多平台手动查询、记录、比价，难以快速定位最优货源

### 1.2 项目目标

**核心目标**：开发一款 Web 端全网比价查询工具，实现 OE 码一键聚合查询，帮助采购人员快速定位最低价货源。

**具体指标**：
- 降低单次比价耗时：从平均 30 分钟缩短至 2 分钟内
- 提升价格透明度：覆盖不少于 4 类主流货源渠道
- 提高决策效率：支持一键导出对比报表，便于审批流程

### 1.3 适用范围

- **目标用户**：汽车维修店、汽配经销商、汽车维修连锁机构采购人员
- **使用场景**：日常零件采购、批量比价、供应商评估
- **适用车型**：覆盖主流乘用车、商用车品牌（不限）

---

## 2. 产品定位

### 2.1 产品价值主张

**核心价值**：全网聚合 · 价格透明 · 智能排序 · 高效导出

**差异化优势**：
- 一键聚合多平台数据，避免重复查询
- 按价格自动排序，快速定位最低价
- 支持 Excel 导出，便于内部分享与存档
- 无需登录，保障采购隐私

### 2.2 功能边界

**包含功能**：
- OE 码全网查询与价格聚合
- 多平台结果展示与排序
- Excel 格式比价报表导出

**不包含功能**：
- 在线支付与订单管理
- 供应商评价与投诉系统
- 用户账户体系与历史记录

---

## 3. 用户角色与使用场景

### 3.1 用户角色

| 角色 | 权限 | 主要诉求 |
|-----|------|---------|
| 汽修店采购员 | 使用全部功能 | 快速找到最低价货源，降低采购成本 |
| 汽配经销商 | 使用全部功能 | 批量比价，寻找高性价比供应商 |
| 连锁机构采购 | 使用全部功能 | 数据透明化，支持审批决策 |

### 3.2 典型使用场景

**场景一：日常零件采购**
1. 采购人员接收到车辆维修需求，获取 OE 码（如 8K0940717）
2. 在工具首页输入 OE 码，点击"全网比价"
3. 查看聚合结果，确认"全网最低"标签商品
4. 点击"立即采购"跳转原平台下单

**场景二：批量比价决策**
1. 采购经理需采购一批常用零件
2. 逐一查询各零件的 OE 码
3. 导出所有结果的 Excel 报表
4. 内部评估后选择最优渠道采购

---

## 4. 功能需求

### 4.1 功能总览

| 功能模块 | 优先级 | 状态 |
|---------|-------|------|
| 首页搜索 | P0 | 待开发 |
| 结果展示 | P0 | 待开发 |
| 数据导出 | P0 | 待开发 |
| 批量比价 | P0 | 待开发 |
| 筛选与分页 | P1 | 待开发 |

### 4.2 核心流程

```
用户输入 OE 码 → 点击搜索 → 系统聚合全网数据 → 结果按价格排序 → 用户查看/导出
```

### 4.3 功能详情

#### 4.3.1 首页与搜索模块

**需求描述**：提供简洁的 OE 码输入界面，支持快速触发全网搜索。

**功能点**：

| 子功能 | 详细需求 | 验收标准 |
|-------|---------|---------|
| 输入框 | 支持字母数字组合，长度限制 8-20 位 | 输入非法字符时给予提示 |
| 搜索触发 | 支持"全网比价"按钮点击及 Enter 键 | Enter 键在输入框内有效 |
| 热门搜索 | 提供 5-10 个高频 OE 码快捷标签 | 点击标签直接触发搜索 |
| 加载状态 | 搜索期间显示 Loading 动画，提示"正在全网搜索..." | 动画流畅，文案清晰 |

**输入校验规则**：
- OE 码格式：允许字母、数字，不区分大小写
- 长度限制：最小 6 位，最大 20 位
- 空值处理：输入为空时，提示"请输入有效的 OE 码"

**边界条件**：
- 网络异常时显示错误提示："网络连接失败，请检查网络后重试"
- 超时处理：请求超过 10 秒无响应时自动终止并提示"查询超时"
- 无结果时显示："未找到相关商品，请检查 OE 码是否正确"

#### 4.3.2 结果展示模块

**需求描述**：聚合多平台数据，以卡片形式展示，按价格从低到高排序。

**功能点**：

| 字段 | 数据格式 | 示例 |
|-----|---------|------|
| 产品图片 | URL 格式，优先白底图 | https://xxx.com/image.jpg |
| 产品名称 | 文本，含 OE 码 | 原厂件 8K0940717 大灯总成 |
| 价格 | 数值，保留两位小数 | 128.00 |
| 供应商名称 | 文本 | 途虎养车旗舰店 |
| 发货地址 | 文本，省市区 | 广东省广州市 |
| 信誉评分 | 星级或数值（1-5） | ★★★★☆ / 4.8 |
| 采购链接 | 原平台商品详情页 URL | https://xxx.com/item/123 |

**排序规则**：
- 默认按价格升序排列（最低价在前）
- 同价格商品按评分降序排列

**特殊标识**：
- 列表中价格最低的条目显示"全网最低"或"推荐"标签
- 标签样式：醒目背景色 + 图标 + 文字

**交互说明**：
- 点击"立即采购"按钮在新窗口打开原平台链接
- 鼠标悬停卡片时显示轻微阴影效果，增强可点击感

**数据聚合要求**：
- 覆盖平台：京东汽车、淘宝/天猫、拼多多、途虎养车、康众汽配、1688
- 聚合逻辑：后端并行调用各平台接口，合并去重后返回

#### 4.3.3 数据导出模块

**需求描述**：支持将搜索结果导出为 Excel 文件，便于存档与分享。

**功能点**：

| 配置项 | 要求 |
|-------|------|
| 文件格式 | .xlsx |
| 表头语言 | 中文 |
| 触发位置 | 结果列表顶部，"导出 Excel"按钮 |
| 文件命名 | 汽配比价_{OE码}_{日期}.xlsx |
| 日期格式 | YYYYMMDD |

**导出字段**：

| 表头字段 | 对应数据列 | 说明 |
|---------|-----------|------|
| OE码 | 产品名称中的 OE 码 | 提取自产品名称 |
| 产品名称 | 完整商品名称 | 原始名称 |
| 价格 | 商品价格 | 数值型 |
| 供应商 | 供应商/店铺名称 | 文本型 |
| 发货地址 | 仓库所在地 | 文本型 |
| 评分 | 信誉评分 | 数值型 |
| 采购链接 | 原平台链接 | 超链接格式 |
| 产品图片 | 图片链接 | 超链接格式 |

**导出校验**：
- 无结果时禁用导出按钮或提示"暂无数据可导出"
- 导出成功后显示 Toast 提示："导出成功"
- 文件体积超过 10MB 时提示"数据量较大，导出中..."

#### 4.3.4 批量比价

**需求描述**：支持用户一次提交多个 OE 码，进行并行比价并汇总结果，适用于采购清单批量比价场景。

**功能点**：
- 批量输入：支持粘贴多行 OE 码或上传 CSV/Excel 文件（单列 OE 码）
- 并行查询：后端并发请求各数据源，并汇总返回（限并发数、避免反爬）
- 汇总视图：显示每个 OE 码的最低价、平台分布、导出按钮
- 进度提示：批量查询显示任务进度（已完成/总量）和错误行数

**验收标准**：
- 可一次提交 1-500 个 OE 码
- 批量查询总用时（各并发限制下）在可接受范围内并显示进度
- 支持将批量结果导出为 Excel，包含每个 OE 码的比价摘要

#### 4.3.5 筛选与分页

**需求描述**：在结果列表提供多维筛选与分页，帮助用户快速定位符合条件的商品。

**功能点**：
- 筛选条件：平台、价格区间、评分区间、发货地、是否包邮
- 排序方式：价格、评分、销量、到货时间
- 分页/无限滚动：支持分页与按需加载（移动端优先无限滚动）
- 每页条数：支持 20/50/100 可选

**验收标准**：
- 筛选操作响应时间小于 1 秒（在缓存命中或本地过滤时）
- 分页稳定，切换页码无数据重复或漏项

#### 4.3.6 并发、超时处理与错误提示

**需求描述**：为保证用户体验，定义后端并发策略、超时处理、错误回退与前端友好提示。

**后端策略**：
- 并发控制：对外部平台请求使用限速与并发池（例如每平台并发不超过 5 个）
- 超时设置：外部请求超时默认 8 秒，整体搜索超时 10 秒；超时应返回局部结果并提示
- 重试机制：对瞬时失败进行指数退避重试（最多 2 次）

**前端体验**：
- 局部失败提示：若部分平台失败，在结果卡片或顶部统一显示"部分平台数据获取失败"的通知
- 重试入口：提供"重试失败源"按钮，允许用户重新请求失败的平台
- 超时提示：若整体查询超过 10 秒，提示"查询超时，已返回部分结果"并允许后台继续完成任务后通知

**验收标准**：
- 在常见网络波动下，系统能够返回部分可用结果并给出明确提示
- 对外部接口错误进行降级展示，不影响主流程

---

## 5. 非功能需求

### 5.1 界面设计（UI/UX）

**设计风格**：
- 主色调：现代商务蓝（#2563EB）
- 设计语言：玻璃拟态（Glassmorphism），圆角设计
- 整体风格：简洁、专业、易用

**响应式适配**：

| 设备类型 | 分辨率范围 | 布局策略 |
|---------|-----------|---------|
| PC 端 | ≥ 1024px | 三栏布局（左筛选、中列表、右详情） |
| 平板 | 768px - 1023px | 双栏布局 |
| 移动端 | < 768px | 单栏卡片布局 |

**交互反馈**：
- 所有按钮支持 Hover 态（悬停）和 Click 态（点击）
- 加载状态：Loading 动画 + 进度提示
- 成功/失败提示：Toast 消息，3 秒后自动消失
- 空状态：友好的插画 + 提示文案

**可访问性**：
- 支持键盘操作（Tab 导航、Enter 提交）
- 颜色对比度符合 WCAG AA 标准
- 图片缺失时显示占位图

### 5.2 性能要求

**响应速度**：

| 操作 | 目标响应时间 | 说明 |
|-----|------------|------|
| OE 码查询 | ≤ 2 秒 | 包含数据聚合与排序 |
| 导出 Excel | ≤ 3 秒 | 100 条数据以内 |
| 页面加载 | ≤ 1.5 秒 | 首屏加载时间 |

**并发能力**：
- 支持 100+ 用户同时查询
- 后端采用异步处理，避免阻塞

**优化策略**：
- 使用 Redis 缓存热门 OE 码查询结果（TTL: 1 小时）
- 图片懒加载，减少首屏加载时间
- 前端使用 CDN 加速静态资源

**性能监控**：
- 记录关键接口的响应时间（P50、P95、P99）
- 异常接口自动告警

### 5.3 安全性

**数据隐私**：
- 不记录用户的搜索历史
- 不收集用户 IP、设备信息等个人数据
- 查询结果仅当前会话有效

**防爬虫保护**：
- 接口限流：同一 IP 1 分钟内最多查询 20 次
- User-Agent 校验：识别异常请求
- 验证码机制：高频查询时触发图形验证码

**数据传输安全**：
- 全站 HTTPS 加密传输
- API 接口使用 Token 认证（可选）

**数据完整性**：
- 导出文件包含数字签名，防止篡改
- 关键操作（如导出）记录操作日志

### 5.4 可用性

**系统可用性**：≥ 99.5%

**故障恢复**：
- 关键接口失败时自动重试（最多 2 次）
- 部分数据源异常时，降级展示剩余平台数据

**兼容性**：
- 浏览器：Chrome 90+、Edge 90+、Firefox 88+、Safari 14+
- 操作系统：Windows 10+、macOS 12+、iOS 14+、Android 10+

### 5.5 可维护性

**代码规范**：
- 前端使用 ESLint + Prettier 统一代码风格
- 后端使用 Pylint / ESLint 进行静态检查
- 关键逻辑添加注释

**版本管理**：
- 使用 Git 进行版本控制
- 重要版本打 Tag

**日志管理**：
- 记录关键操作日志
- 日志保留 30 天
- 支持日志检索与分析

---

## 6. 数据需求

### 6.1 数据来源

| 数据类型 | 平台示例 | 接入方式 |
|---------|---------|---------|
| 综合电商平台 | 京东汽车、淘宝/天猫、拼多多 | API / 爬虫 |
| 垂直汽配平台 | 途虎养车、康众汽配、邦邦汽服 | API / 爬虫 |
| B2B 批发平台 | 1688（阿里巴巴）、慧聪网 | API / 爬虫 |
| 独立站/线下 | 大型汽配城独立站、ERP 接口 | API / 对接 |

**数据覆盖要求**：
- 至少覆盖 4 类平台
- 每类平台至少接入 1 个主流平台
- V1.0 优先接入：京东、淘宝、途虎、1688

### 6.2 数据字段规范

| 字段 | 数据类型 | 必填 | 示例 | 说明 |
|-----|---------|------|------|------|
| oe_code | String | 是 | 8K0940717 | 原 OE 码 |
| product_name | String | 是 | 大灯总成 | 商品名称 |
| price | Decimal | 是 | 128.00 | 价格（CNY） |
| supplier_name | String | 是 | 途虎旗舰店 | 供应商名称 |
| location | String | 否 | 广东广州 | 发货地址 |
| rating | Float | 否 | 4.8 | 评分（1-5） |
| product_image | String | 否 | https://... | 商品图片 URL |
| product_url | String | 是 | https://... | 商品详情页 URL |
| platform | String | 是 | 京东 | 平台名称 |
| stock_status | String | 否 | 有货 | 库存状态 |
| shipping_fee | Decimal | 否 | 0.00 | 运费（若有） |

### 6.3 数据清洗规则

**去重规则**：
- 按 OE 码 + 产品名称进行模糊匹配
- 相似度阈值：≥ 85% 视为同一商品
- 保留价格更低、评分更高的记录

**单位统一**：
- 所有价格统一为人民币（CNY）
- 若为外币，按实时汇率转换
- 运费单独标注，不混入商品价格

**图片处理**：
- 优先选择白底图或细节清晰的主图
- 图片尺寸：推荐 400×400 像素以上
- 无图片时使用默认占位图

**数据质量**：
- 剔除价格异常高/低的噪点数据（如超出均价 10 倍）
- 缺失关键字段（如 price、product_url）的记录剔除
- 库存状态为"缺货"的记录剔除

### 6.4 数据更新策略

| 数据类型 | 更新频率 | 更新机制 |
|---------|---------|---------|
| 实时查询结果 | 按需更新 | 用户触发搜索时实时查询 |
| 热门 OE 码缓存 | 1 小时 | Redis 缓存，定时刷新 |
| 汇率数据 | 每日 1 次 | 定时任务更新 |

---

## 7. 技术架构

### 7.1 整体架构

```
┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│   用户浏览器  │ ──> │  前端页面    │ ──> │  后端 API    │
└─────────────┘     └─────────────┘     └─────────────┘
                                              │
                    ┌─────────────────────────┼─────────────────────────┐
                    │                         │                         │
              ┌──────────┐              ┌──────────┐              ┌──────────┐
              │  京东 API │              │ 淘宝 API │              │ 途虎 API │
              └──────────┘              └──────────┘              └──────────┘
                                              │
                                        ┌──────────┐
                                        │  Redis   │
                                        └──────────┘
```

### 7.2 前端技术栈

| 技术选型 | 版本 | 用途 |
|---------|------|------|
| HTML5 | - | 页面结构 |
| Tailwind CSS | 3.x | 样式框架 |
| Native JavaScript | ES6+ | 业务逻辑 |
| SheetJS (xlsx) | 最新版 | Excel 导出 |
| FontAwesome | 最新版 | 图标库 |

**依赖管理**：
- 使用 CDN 引入第三方库
- 或使用 npm + Vite 打包

### 7.3 后端技术栈

**推荐方案**：

| 技术选型 | 用途 | 说明 |
|---------|------|------|
| Node.js (Express) / Python (FastAPI) | API 服务 | 根据团队技术栈选择 |
| Redis | 缓存 | 缓存查询结果 |
| PostgreSQL / MySQL | 日志存储 | 记录操作日志（可选） |
| Nginx | 反向代理 | 处理 CORS、负载均衡 |

**API 接口设计**：

```
POST /api/search
Request:
{
  "oe_code": "8K0940717"
}

Response:
{
  "code": 200,
  "message": "success",
  "data": [
    {
      "oe_code": "8K0940717",
      "product_name": "原厂件 8K0940717 大灯总成",
      "price": 128.00,
      "supplier_name": "途虎旗舰店",
      "location": "广东省广州市",
      "rating": 4.8,
      "product_image": "https://...",
      "product_url": "https://...",
      "platform": "途虎"
    }
  ]
}
```

**错误码设计**：

| 错误码 | 说明 | HTTP 状态码 |
|-------|------|------------|
| 200 | 成功 | 200 |
| 400 | 参数错误 | 400 |
| 404 | 未找到数据 | 404 |
| 429 | 请求过于频繁 | 429 |
| 500 | 服务器错误 | 500 |

### 7.4 部署架构

**前端部署**：
- 静态资源托管：Nginx / 阿里云 OSS / 腾讯云 COS
- CDN 加速：阿里云 CDN / 腾讯云 CDN

**后端部署**：
- 服务器：阿里云 ECS / 腾讯云 CVM
- 容器化：Docker + Docker Compose
- 进程管理：PM2 / Supervisor

### 7.5 开发环境

| 环境 | 用途 | 配置 |
|-----|------|------|
| 开发环境 | 本地开发 | Node.js 16+, Python 3.8+ |
| 测试环境 | 联调测试 | 模拟数据源 |
| 生产环境 | 线上服务 | 真实数据源 |

---

## 8. 项目规划

### 8.1 版本规划

| 版本 | 发布时间 | 主要功能 |
|-----|---------|---------|
| V1.0 | T+4 周 | 核心查询、结果展示、Excel 导出 |
| V1.1 | T+8 周 | 历史价格走势图表 |
| V1.2 | T+12 周 | 收藏夹功能 |

### 8.2 里程碑

| 阶段 | 时间节点 | 交付物 |
|-----|---------|-------|
| 需求确认 | Week 1 | 本 PRD 文档 |
| UI 设计 | Week 2 | 设计稿（Figma） |
| 后端开发 | Week 3-4 | API 接口、数据聚合逻辑 |
| 前端开发 | Week 3-4 | 前端页面、交互逻辑 |
| 联调测试 | Week 5 | 测试报告、Bug 修复 |
| 上线发布 | Week 6 | 生产环境部署 |

### 8.3 测试计划

**功能测试**：
- 输入框校验测试
- 搜索功能测试
- 结果排序测试
- Excel 导出测试

**性能测试**：
- 并发压力测试（100 用户）
- 接口响应时间测试
- 大数据量导出测试（1000+ 条）

**兼容性测试**：
- 多浏览器兼容性测试
- 移动端适配测试

**安全测试**：
- SQL 注入测试
- XSS 攻击测试
- 限流机制测试

---

## 9. 风险与应对

### 9.1 技术风险

| 风险 | 影响 | 应对措施 |
|-----|------|---------|
| 数据源接口不稳定 | 搜索失败率高 | 增加重试机制，准备备用数据源 |
| 跨域（CORS）限制 | 前端无法直接请求 | 后端代理转发，统一 API 出口 |
| 爬虫反爬 | 数据获取失败 | 使用代理 IP、模拟浏览器行为 |

### 9.2 业务风险

| 风险 | 影响 | 应对措施 |
|-----|------|---------|
| 数据准确性问题 | 用户体验差 | 建立数据审核机制，用户反馈通道 |
| 平台政策变化 | 数据源失效 | 提前监控平台动态，灵活切换方案 |

### 9.3 合规风险

| 风险 | 影响 | 应对措施 |
|-----|------|---------|
| 数据爬取合规性 | 法律风险 | 仅公开数据，尊重 robots.txt |
| 用户数据隐私 | 监管风险 | 不记录搜索历史，符合 GDPR 要求 |

---

## 附录

### A. 术语表

| 术语 | 说明 |
|-----|------|
| OE 码 | Original Equipment 原厂零件编码 |
| SKU | Stock Keeping Unit，库存单位 |
| CORS | Cross-Origin Resource Sharing，跨域资源共享 |

### B. 参考文档

- [Tailwind CSS 官方文档](https://tailwindcss.com/)
- [SheetJS 文档](https://docs.sheetjs.com/)
- [Express.js 文档](https://expressjs.com/)
- [FastAPI 文档](https://fastapi.tiangolo.com/)

### C. 变更记录

| 版本 | 日期 | 修改人 | 修改内容 |
|-----|------|-------|---------|
| V1.0 | 2025-01-29 | 产品团队 | 初始版本 |
| V1.1 | 2026-01-29 | 产品团队 | 补充功能需求：批量比价、筛选与分页、并发/超时处理章节 |

---

**文档结束**
